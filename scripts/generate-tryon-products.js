import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Map folder names to tryOn keys
const categoryMap = {
  'Necklace': 'necklace',
  'Earrings': 'earrings',
  'Rings': 'rings',
  'Bracelets': 'bracelet'
};

const imageDir = path.join(__dirname, '..', 'public', 'image');
const outputFile = path.join(__dirname, '..', 'src', 'utils', 'tryOnProducts.generated.js');

function scanImagesFolder() {
  const products = {
    necklace: [],
    earrings: [],
    rings: [],
    bracelet: []
  };

  // Scan each category folder
  for (const [folderName, categoryKey] of Object.entries(categoryMap)) {
    const categoryPath = path.join(imageDir, folderName);

    if (!fs.existsSync(categoryPath)) {
      console.warn(`Warning: Folder not found: ${categoryPath}`);
      continue;
    }

    const files = fs.readdirSync(categoryPath);

    // Find all *Image.png files
    const imageFiles = files.filter(file =>
      file.endsWith('Image.png') || file.endsWith('Image.jpg') || file.endsWith('Image.jpeg')
    );

    // Extract product names (remove "Image.png" suffix)
    const productNames = imageFiles.map(file => {
      return file.replace(/Image\.(png|jpg|jpeg)$/i, '');
    });

    products[categoryKey] = productNames.map(name => ({ name }));

    console.log(`Found ${productNames.length} products in ${folderName}:`, productNames.join(', '));
  }

  return products;
}

function generateFile(products) {
  const content = `// This file is auto-generated by scripts/generate-tryon-products.js
// DO NOT EDIT MANUALLY - Run 'npm run generate:tryon' to regenerate

export const tryOnProducts = ${JSON.stringify(products, null, 2)};
`;

  fs.writeFileSync(outputFile, content, 'utf8');
  console.log(`\n✓ Generated: ${outputFile}`);
}

// Main execution
try {
  console.log('Scanning for try-on images...\n');
  const products = scanImagesFolder();
  generateFile(products);
  console.log('\n✓ Done! Try-on products list has been updated.');
} catch (error) {
  console.error('Error generating try-on products:', error);
  process.exit(1);
}
